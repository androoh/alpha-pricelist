(self.webpackChunknguide_pricelist_ui=self.webpackChunknguide_pricelist_ui||[]).push([[608],{5608:(e,i,t)=>{"use strict";t.r(i),t.d(i,{PricesModule:()=>I});var r=t(8583),o=t(7029),s=t(7716),n=t(138),c=t(264),l=t(2340),a=t(1841);let p=(()=>{class e{constructor(e){this.http=e}getPriceListProductModelsAndOptions(e){return this.http.get(l.N.apiBaseURL+"prices/"+e)}savePrices(e,i){return this.http.put(l.N.apiBaseURL+"prices/"+e,{prices:i})}}return e.\u0275fac=function(i){return new(i||e)(s.LFG(a.eN))},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var d=t(1873),u=t(3679);function h(e,i){if(1&e){const e=s.EpF();s.ynx(0),s.TgZ(1,"td"),s.TgZ(2,"label"),s._uU(3,"Delivery price"),s.qZA(),s.TgZ(4,"input",10),s.NdJ("ngModelChange",function(i){s.CHM(e);const t=s.oxw().$implicit;return s.oxw(2).pricesModel[t.id].delivery_price=i}),s.qZA(),s.TgZ(5,"label"),s._uU(6,"Installation price"),s.qZA(),s.TgZ(7,"input",10),s.NdJ("ngModelChange",function(i){s.CHM(e);const t=s.oxw().$implicit;return s.oxw(2).pricesModel[t.id].installation_price=i}),s.qZA(),s.qZA(),s.TgZ(8,"td"),s.TgZ(9,"label"),s.TgZ(10,"input",11),s.NdJ("ngModelChange",function(i){s.CHM(e);const t=s.oxw().$implicit;return s.oxw(2).pricesModel[t.id].delivery_price_on_demand=i}),s.qZA(),s._uU(11," Delivery price "),s.qZA(),s.TgZ(12,"label"),s.TgZ(13,"input",11),s.NdJ("ngModelChange",function(i){s.CHM(e);const t=s.oxw().$implicit;return s.oxw(2).pricesModel[t.id].installation_price_on_demand=i}),s.qZA(),s._uU(14," Installation price "),s.qZA(),s.qZA(),s.BQk()}if(2&e){const e=s.oxw().$implicit,i=s.oxw(2);s.xp6(4),s.Q6J("ngModel",i.pricesModel[e.id].delivery_price),s.xp6(3),s.Q6J("ngModel",i.pricesModel[e.id].installation_price),s.xp6(3),s.Q6J("ngModel",i.pricesModel[e.id].delivery_price_on_demand),s.xp6(3),s.Q6J("ngModel",i.pricesModel[e.id].installation_price_on_demand)}}function m(e,i){if(1&e){const e=s.EpF();s.ynx(0),s.TgZ(1,"td"),s.TgZ(2,"input",10),s.NdJ("ngModelChange",function(i){s.CHM(e);const t=s.oxw().$implicit;return s.oxw(2).pricesModel[t.id].value=i}),s.qZA(),s.qZA(),s.TgZ(3,"td"),s.TgZ(4,"input",11),s.NdJ("ngModelChange",function(i){s.CHM(e);const t=s.oxw().$implicit;return s.oxw(2).pricesModel[t.id].onDemand=i}),s.qZA(),s.qZA(),s.BQk()}if(2&e){const e=s.oxw().$implicit,i=s.oxw(2);s.xp6(2),s.Q6J("ngModel",i.pricesModel[e.id].value),s.xp6(2),s.Q6J("ngModel",i.pricesModel[e.id].onDemand)}}function g(e,i){if(1&e&&(s.TgZ(0,"tr"),s.TgZ(1,"td"),s._uU(2),s.qZA(),s.TgZ(3,"td"),s._uU(4),s.qZA(),s.YNc(5,h,15,4,"ng-container",9),s.YNc(6,m,5,2,"ng-container",9),s.qZA()),2&e){const e=i.$implicit;s.xp6(2),s.Oqu(e.name||"-"),s.xp6(2),s.Oqu(e.sku),s.xp6(1),s.Q6J("ngIf","product_main"===e.type),s.xp6(1),s.Q6J("ngIf","product_main"!==e.type)}}function f(e,i){if(1&e&&(s.TgZ(0,"table",6),s.TgZ(1,"thead"),s.TgZ(2,"tr"),s.TgZ(3,"th"),s._uU(4,"Name"),s.qZA(),s.TgZ(5,"th"),s._uU(6,"Sku"),s.qZA(),s.TgZ(7,"th",7),s._uU(8,"Price"),s.qZA(),s.TgZ(9,"th"),s._uU(10,"On Demand"),s.qZA(),s.qZA(),s.qZA(),s.TgZ(11,"tbody"),s.YNc(12,g,7,4,"tr",8),s.qZA(),s.qZA()),2&e){const e=s.oxw();s.xp6(12),s.Q6J("ngForOf",e.priceLists)}}let v=(()=>{class e{constructor(e,i,t,r,o){this.resourcesService=e,this.activatedRoute=i,this.pricesService=t,this.breadcrumbService=r,this.alertsService=o,this.priceLists=[],this.pricesModel={},this.priceListId=null,this.defaultLocale="nl"}ngOnInit(){this.activatedRoute.paramMap.subscribe(e=>{this.priceListId=e.get("id"),this.priceListId&&(this.initBreadcrumb(),this.loadData(this.priceListId))})}loadData(e){this.pricesService.getPriceListProductModelsAndOptions(e).subscribe(e=>{var i,t,r,o,s,n;this.priceLists=e.data,this.defaultLocale=e.defaultLocale;for(let c of this.priceLists)if("product_main"===c.type){const e={delivery_price:(null===(i=c.price)||void 0===i?void 0:i.delivery_price)||0,installation_price:(null===(t=c.price)||void 0===t?void 0:t.installation_price)||0,delivery_price_on_demand:(null===(r=c.price)||void 0===r?void 0:r.delivery_price_on_demand)||!1,installation_price_on_demand:(null===(o=c.price)||void 0===o?void 0:o.installation_price_on_demand)||!1};this.pricesModel[c.id]=e}else{const e={value:(null===(s=c.price)||void 0===s?void 0:s.value)||0,onDemand:(null===(n=c.price)||void 0===n?void 0:n.onDemand)||!1};this.pricesModel[c.id]=e}})}submit(){this.priceListId&&this.pricesService.savePrices(this.priceListId,this.pricesModel).subscribe(e=>{this.alertsService.show(o.NK.success,"Prices updated!")})}initBreadcrumb(){this.breadcrumbService.setBreadcrumb([{label:"Home",path:["/dashboard"]},{label:"Price lists",path:["/resources/priceList"]},{label:"Edit Price list",path:[`/resources/priceList/${this.priceListId}/edit`]},{label:"Assign Prices",path:[`/price-assign/${this.priceListId}`]}]),this.breadcrumbService.update()}}return e.\u0275fac=function(i){return new(i||e)(s.Y36(n.z6),s.Y36(c.gz),s.Y36(p),s.Y36(d.p),s.Y36(o.ml))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-price-assign"]],decls:8,vars:2,consts:[[1,"pt-4","row","sticky-top","bg-white","overflow-hidden","pb-2","border-bottom"],[1,"col-9"],[1,"col-3","text-end"],["type","button",1,"btn","btn-primary","submit-button",3,"disabled","click"],[1,"bi","bi-save"],["class","table mt-2",4,"ngIf"],[1,"table","mt-2"],[2,"width","200px"],[4,"ngFor","ngForOf"],[4,"ngIf"],["type","number",1,"form-control","form-control-sm",3,"ngModel","ngModelChange"],["type","checkbox",1,"form-check-input",3,"ngModel","ngModelChange"]],template:function(e,i){1&e&&(s.TgZ(0,"div",0),s.TgZ(1,"h2",1),s._uU(2,"Assign Prices"),s.qZA(),s.TgZ(3,"div",2),s.TgZ(4,"button",3),s.NdJ("click",function(){return i.submit()}),s._UZ(5,"i",4),s._uU(6," Save "),s.qZA(),s.qZA(),s.qZA(),s.YNc(7,f,13,1,"table",5)),2&e&&(s.xp6(4),s.Q6J("disabled",!i.priceListId),s.xp6(3),s.Q6J("ngIf",i.priceLists.length>0))},directives:[r.O5,r.sg,u.wV,u.Fj,u.JJ,u.On,u.Wl],styles:[""]}),e})();var Z=t(8550),b=t(6715),w=t(3500),_=t(2114),A=t(6661),x=t(4463),q=t(5790),T=t(9075);const L=["iframe"];function C(e,i){if(1&e&&(s.TgZ(0,"option",16),s._uU(1),s.qZA()),2&e){const e=i.$implicit;s.Q6J("value",e.key),s.xp6(1),s.Oqu(e.value)}}function M(e,i){if(1&e&&(s.TgZ(0,"option",16),s._uU(1),s.qZA()),2&e){const e=i.$implicit;s.Q6J("value",e),s.xp6(1),s.Oqu(e)}}function U(e,i){if(1&e&&(s.TgZ(0,"option",16),s._uU(1),s.qZA()),2&e){const e=i.$implicit;s.Q6J("value",e),s.xp6(1),s.Oqu(e)}}const y=[{path:":id",component:v},{path:"preview/:id",component:(()=>{class e{constructor(e,i,t,r,o){this.ref=e,this.activatedRoute=i,this.sanitizer=t,this.breadcrumbService=r,this.resourcesService=o,this.priceListId=null,this.resourceName="priceList",this.templateUrl="",this.iframeLoaded=!1,this.locales=[],this.defaultLocale="nl",this.resourceInfo=null,this.pageSizes=["A0","A1","A2","A3","A4","A5","A6","A7","A10","B4","B5","letter","legal","ledger"],this.pageOrientations=["portrait","landscape"],this.model={},this.mainUrl="",this.form=new u.cw({locale:new u.NI(""),pageSize:new u.NI("A4"),showCropBorders:new u.NI(!1),showCross:new u.NI(!1),pageOrientation:new u.NI("portrait")})}ngOnInit(){this.activatedRoute.paramMap.subscribe(e=>{this.priceListId=e.get("id"),this.resourceName&&this.resourcesService.getResourceInfo(this.resourceName).subscribe(e=>{this.resourceInfo=e,this.initBreadcrumb(),this.priceListId&&this.resourcesService.getEditResourceSchema(this.resourceName,this.priceListId).subscribe(e=>{var i,t;this.defaultLocale=e.defaultLocale,null===(i=this.form.get("locale"))||void 0===i||i.setValue(this.defaultLocale),this.model=null==e?void 0:e.data,this.locales=this.mapLocales(e.locales,(null===(t=this.model)||void 0===t?void 0:t.language)||[]),this.mainUrl=l.N.apiBaseURL+"resources/"+this.resourceName+"/"+this.priceListId+"/html?path=&template=pricelist",this.updateTemplateUrl(this.form.value)})})}),this.form.valueChanges.subscribe(e=>{e&&this.updateTemplateUrl(e)})}updateTemplateUrl(e){const i={locale:(null==e?void 0:e.locale)||"nl",pageSize:(null==e?void 0:e.pageSize)||"A4",showCropBorders:(null==e?void 0:e.showCropBorders)||!1,showCross:(null==e?void 0:e.showCross)||!1,pageOrientation:(null==e?void 0:e.pageOrientation)||"portrait"},t=[];this.iframeLoaded=!1;for(const r in i)t.push(r+"="+i[r]);this.ref.reattach(),this.templateUrl=this.mainUrl+"&"+t.join("&")}getPreviewURL(){const e=this.sanitizer.bypassSecurityTrustResourceUrl(this.templateUrl);return this.templateUrl&&this.ref.detach(),e}mapLocales(e,i){const t=[];for(const r in e)i.includes(r)&&t.push({key:r,value:e[r]});return t}initBreadcrumb(){this.breadcrumbService.setBreadcrumb([{label:"Home",path:["/dashboard"]},{label:"Price lists",path:["/resources/priceList"]},{label:"Edit Price list",path:[`/resources/priceList/${this.priceListId}/edit`]},{label:"Preview Price List",path:[`/price-assign/preview/${this.priceListId}`]}]),this.breadcrumbService.update()}print(){window.open(this.templateUrl,"_blank")}setIframeLoaded(){}}return e.\u0275fac=function(i){return new(i||e)(s.Y36(s.sBO),s.Y36(c.gz),s.Y36(T.H7),s.Y36(d.p),s.Y36(n.z6))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-preview"]],viewQuery:function(e,i){if(1&e&&s.Gf(L,5),2&e){let e;s.iGM(e=s.CRH())&&(i.iframe=e.first)}},decls:24,vars:10,consts:[[1,"d-flex","flex-column","h-100"],[1,"pt-4","row","sticky-top","bg-white","overflow-hidden","border-bottom","pb-2"],[1,"col-3","mb-0"],[1,"col-9","text-end","row","g-3","m-0"],[1,"form-select","col","me-2","mt-0",3,"formControl"],[3,"value",4,"ngFor","ngForOf"],["title","Show Crop Borders",1,"form-check","col","me-2","mt-2"],["type","checkbox","id","showCropBorders",1,"form-check-input",3,"formControl"],["for","showCropBorders",1,"form-check-label","text-truncate"],["title","Show Crop Cross",1,"form-check","col","me-2","mt-2"],["type","checkbox","id","showCross",1,"form-check-input",3,"formControl"],["for","showCross",1,"form-check-label","text-truncate"],["type","button",1,"btn","btn-primary","col","me-2","mt-0",3,"click"],[1,"bi","bi-printer"],[1,"mt-3","flex-grow-1",3,"src","load"],["iframe",""],[3,"value"]],template:function(e,i){1&e&&(s.TgZ(0,"div",0),s.TgZ(1,"div",1),s.TgZ(2,"h2",2),s._uU(3),s.qZA(),s.TgZ(4,"div",3),s.TgZ(5,"select",4),s.YNc(6,C,2,2,"option",5),s.qZA(),s.TgZ(7,"select",4),s.YNc(8,M,2,2,"option",5),s.qZA(),s.TgZ(9,"select",4),s.YNc(10,U,2,2,"option",5),s.qZA(),s.TgZ(11,"div",6),s._UZ(12,"input",7),s.TgZ(13,"label",8),s._uU(14," Show Crop Borders "),s.qZA(),s.qZA(),s.TgZ(15,"div",9),s._UZ(16,"input",10),s.TgZ(17,"label",11),s._uU(18," Show Crop Cross "),s.qZA(),s.qZA(),s.TgZ(19,"button",12),s.NdJ("click",function(){return i.print()}),s._UZ(20,"i",13),s._uU(21," Print "),s.qZA(),s.qZA(),s.qZA(),s.TgZ(22,"iframe",14,15),s.NdJ("load",function(){return i.setIframeLoaded()}),s.qZA(),s.qZA()),2&e&&(s.xp6(3),s.hij("Preview ",null==i.resourceInfo?null:i.resourceInfo.label,""),s.xp6(2),s.Q6J("formControl",i.form.get("locale")),s.xp6(1),s.Q6J("ngForOf",i.locales),s.xp6(1),s.Q6J("formControl",i.form.get("pageSize")),s.xp6(1),s.Q6J("ngForOf",i.pageSizes),s.xp6(1),s.Q6J("formControl",i.form.get("pageOrientation")),s.xp6(1),s.Q6J("ngForOf",i.pageOrientations),s.xp6(2),s.Q6J("formControl",i.form.get("showCropBorders")),s.xp6(4),s.Q6J("formControl",i.form.get("showCross")),s.xp6(6),s.Q6J("src",i.getPreviewURL(),s.uOi))},directives:[u.EJ,u.JJ,u.oH,r.sg,u.Wl,u.YN,u.Kr],styles:["[_nghost-%COMP%]{width:100%;height:100%}"],changeDetection:0}),e})()}];let I=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({imports:[[r.ez,u.u5,Z.xD,c.Bz.forChild(y),u.UX,b.z$,w.X0.forChild({extras:{lazyRender:!0},wrappers:[{name:"panel",component:_.Z}],types:[{name:"images",component:A.Pw,wrappers:["form-field"]},{name:"repeat",component:x.$},{name:"hasMany",component:q.a}]})]]}),e})()}}]);