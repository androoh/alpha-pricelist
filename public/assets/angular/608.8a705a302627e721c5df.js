(self.webpackChunknguide_pricelist_ui=self.webpackChunknguide_pricelist_ui||[]).push([[608],{5608:(e,t,i)=>{"use strict";i.r(t),i.d(t,{PricesModule:()=>J});var r=i(8583),s=i(7029),o=i(7716),c=i(9486),a=i(264),n=i(2340),l=i(1841);let p=(()=>{class e{constructor(e){this.http=e}getPriceListProductModelsAndOptions(e){return this.http.get(n.N.apiBaseURL+"prices/"+e)}savePrices(e,t){return this.http.put(n.N.apiBaseURL+"prices/"+e,{prices:t})}}return e.\u0275fac=function(t){return new(t||e)(o.LFG(l.eN))},e.\u0275prov=o.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var u=i(1873),d=i(3679);function h(e,t){if(1&e&&(o.TgZ(0,"strong"),o._uU(1),o.qZA()),2&e){const e=o.oxw().$implicit,t=o.oxw(2);o.xp6(1),o.hij("",e.parent[t.defaultLocale],": ")}}function m(e,t){if(1&e){const e=o.EpF();o.TgZ(0,"tr"),o.TgZ(1,"td"),o.YNc(2,h,2,1,"strong",8),o._uU(3),o.qZA(),o.TgZ(4,"td"),o._uU(5),o.qZA(),o.TgZ(6,"td"),o.TgZ(7,"input",9),o.NdJ("ngModelChange",function(t){const i=o.CHM(e).$implicit;return o.oxw(2).pricesModel[i.id]=t}),o.qZA(),o.qZA(),o.qZA()}if(2&e){const e=t.$implicit,i=o.oxw(2);o.xp6(2),o.Q6J("ngIf",e.parent&&e.parent[i.defaultLocale]),o.xp6(1),o.hij(" ",e.name[i.defaultLocale]||"-",""),o.xp6(2),o.Oqu(e.sku),o.xp6(2),o.Q6J("ngModel",i.pricesModel[e.id])}}function f(e,t){if(1&e&&(o.TgZ(0,"table",6),o.TgZ(1,"thead"),o.TgZ(2,"tr"),o.TgZ(3,"th"),o._uU(4,"Name"),o.qZA(),o.TgZ(5,"th"),o._uU(6,"Sku"),o.qZA(),o.TgZ(7,"th"),o._uU(8,"Price"),o.qZA(),o.qZA(),o.qZA(),o.TgZ(9,"tbody"),o.YNc(10,m,8,4,"tr",7),o.qZA(),o.qZA()),2&e){const e=o.oxw();o.xp6(10),o.Q6J("ngForOf",e.priceLists)}}let g=(()=>{class e{constructor(e,t,i,r,s){this.resourcesService=e,this.activatedRoute=t,this.pricesService=i,this.breadcrumbService=r,this.alertsService=s,this.priceLists=[],this.pricesModel={},this.priceListId=null,this.defaultLocale="nl"}ngOnInit(){this.activatedRoute.paramMap.subscribe(e=>{this.priceListId=e.get("id"),this.priceListId&&(this.initBreadcrumb(),this.loadData(this.priceListId))})}loadData(e){this.pricesService.getPriceListProductModelsAndOptions(e).subscribe(e=>{this.priceLists=e.data,this.defaultLocale=e.defaultLocale;for(let t of this.priceLists)this.pricesModel[t.id]=t.price})}submit(){this.priceListId&&(console.log(this.pricesModel),this.pricesService.savePrices(this.priceListId,this.pricesModel).subscribe(e=>{this.alertsService.show(s.NK.success,"Prices updated!")}))}initBreadcrumb(){this.breadcrumbService.setBreadcrumb([{label:"Home",path:["/dashboard"]},{label:"Price lists",path:["/resources/priceList"]},{label:"Edit Price list",path:[`/resources/priceList/${this.priceListId}/edit`]},{label:"Assign Prices",path:[`/price-assign/${this.priceListId}`]}]),this.breadcrumbService.update()}}return e.\u0275fac=function(t){return new(t||e)(o.Y36(c.z6),o.Y36(a.gz),o.Y36(p),o.Y36(u.p),o.Y36(s.ml))},e.\u0275cmp=o.Xpm({type:e,selectors:[["app-price-assign"]],decls:8,vars:2,consts:[[1,"pt-4","row","sticky-top","bg-white","overflow-hidden","pb-2","border-bottom"],[1,"col-9"],[1,"col-3","text-end"],["type","button",1,"btn","btn-primary","submit-button",3,"disabled","click"],[1,"bi","bi-save"],["class","table mt-2",4,"ngIf"],[1,"table","mt-2"],[4,"ngFor","ngForOf"],[4,"ngIf"],["type","number",1,"form-control","form-control-sm",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(o.TgZ(0,"div",0),o.TgZ(1,"h2",1),o._uU(2,"Assign Prices"),o.qZA(),o.TgZ(3,"div",2),o.TgZ(4,"button",3),o.NdJ("click",function(){return t.submit()}),o._UZ(5,"i",4),o._uU(6," Save "),o.qZA(),o.qZA(),o.qZA(),o.YNc(7,f,11,1,"table",5)),2&e&&(o.xp6(4),o.Q6J("disabled",!t.priceListId),o.xp6(3),o.Q6J("ngIf",t.priceLists.length>0))},directives:[r.O5,r.sg,d.wV,d.Fj,d.JJ,d.On],styles:[""]}),e})();var b=i(8550),Z=i(6715),v=i(3500),w=i(2114),L=i(6661),A=i(4463),q=i(5790),x=i(9075);const C=["iframe"];function T(e,t){if(1&e&&(o.TgZ(0,"option",16),o._uU(1),o.qZA()),2&e){const e=t.$implicit;o.Q6J("value",e.key),o.xp6(1),o.Oqu(e.value)}}function I(e,t){if(1&e&&(o.TgZ(0,"option",16),o._uU(1),o.qZA()),2&e){const e=t.$implicit;o.Q6J("value",e),o.xp6(1),o.Oqu(e)}}function U(e,t){if(1&e&&(o.TgZ(0,"option",16),o._uU(1),o.qZA()),2&e){const e=t.$implicit;o.Q6J("value",e),o.xp6(1),o.Oqu(e)}}const S=[{path:":id",component:g},{path:"preview/:id",component:(()=>{class e{constructor(e,t,i,r,s){this.ref=e,this.activatedRoute=t,this.sanitizer=i,this.breadcrumbService=r,this.resourcesService=s,this.priceListId=null,this.resourceName="priceList",this.templateUrl="",this.iframeLoaded=!1,this.locales=[],this.defaultLocale="nl",this.resourceInfo=null,this.pageSizes=["A0","A1","A2","A3","A4","A5","A6","A7","A10","B4","B5","letter","legal","ledger"],this.pageOrientations=["portrait","landscape"],this.model={},this.form=new d.cw({locale:new d.NI(""),pageSize:new d.NI("A4"),showCropBorders:new d.NI(!1),showCross:new d.NI(!1),pageOrientation:new d.NI("portrait")})}ngOnInit(){this.activatedRoute.paramMap.subscribe(e=>{this.priceListId=e.get("id"),this.resourceName&&this.resourcesService.getResourceInfo(this.resourceName).subscribe(e=>{this.resourceInfo=e,this.initBreadcrumb(),this.priceListId&&this.resourcesService.getEditResourceSchema(this.resourceName,this.priceListId).subscribe(e=>{var t,i;this.defaultLocale=e.defaultLocale,null===(t=this.form.get("locale"))||void 0===t||t.setValue(this.defaultLocale),this.model=e.data,this.locales=this.mapLocales(e.locales,(null===(i=this.model)||void 0===i?void 0:i.language)||[])})})}),this.form.valueChanges.subscribe(e=>{e&&this.updateTemplateUrl({locale:(null==e?void 0:e.locale)||"nl",pageSize:(null==e?void 0:e.pageSize)||"A4",showCropBorders:(null==e?void 0:e.showCropBorders)||!1,showCross:(null==e?void 0:e.showCross)||!1,pageOrientation:(null==e?void 0:e.pageOrientation)||"portrait"})})}updateTemplateUrl(e){const t=[];this.iframeLoaded=!1;for(const i in e)t.push(i+"="+e[i]);this.ref.reattach(),this.templateUrl=n.N.apiBaseURL+"html?"+t.join("&")}getPreviewURL(){const e=this.sanitizer.bypassSecurityTrustResourceUrl(this.templateUrl);return this.templateUrl&&this.ref.detach(),e}mapLocales(e,t){const i=[];for(const r in e)t.includes(r)&&i.push({key:r,value:e[r]});return i}initBreadcrumb(){this.breadcrumbService.setBreadcrumb([{label:"Home",path:["/dashboard"]},{label:"Price lists",path:["/resources/priceList"]},{label:"Edit Price list",path:[`/resources/priceList/${this.priceListId}/edit`]},{label:"Preview Price List",path:[`/price-assign/preview/${this.priceListId}`]}]),this.breadcrumbService.update()}print(){window.open(this.templateUrl,"_blank")}setIframeLoaded(){}}return e.\u0275fac=function(t){return new(t||e)(o.Y36(o.sBO),o.Y36(a.gz),o.Y36(x.H7),o.Y36(u.p),o.Y36(c.z6))},e.\u0275cmp=o.Xpm({type:e,selectors:[["app-preview"]],viewQuery:function(e,t){if(1&e&&o.Gf(C,5),2&e){let e;o.iGM(e=o.CRH())&&(t.iframe=e.first)}},decls:24,vars:10,consts:[[1,"d-flex","flex-column","h-100"],[1,"pt-4","row","sticky-top","bg-white","overflow-hidden","border-bottom","pb-2"],[1,"col-3","mb-0"],[1,"col-9","text-end","row","g-3","m-0"],[1,"form-select","col","me-2","mt-0",3,"formControl"],[3,"value",4,"ngFor","ngForOf"],["title","Show Crop Borders",1,"form-check","col","me-2","mt-2"],["type","checkbox","id","showCropBorders",1,"form-check-input",3,"formControl"],["for","showCropBorders",1,"form-check-label","text-truncate"],["title","Show Crop Cross",1,"form-check","col","me-2","mt-2"],["type","checkbox","id","showCross",1,"form-check-input",3,"formControl"],["for","showCross",1,"form-check-label","text-truncate"],["type","button",1,"btn","btn-primary","col","me-2","mt-0",3,"click"],[1,"bi","bi-printer"],[1,"mt-3","flex-grow-1",3,"src","load"],["iframe",""],[3,"value"]],template:function(e,t){1&e&&(o.TgZ(0,"div",0),o.TgZ(1,"div",1),o.TgZ(2,"h2",2),o._uU(3),o.qZA(),o.TgZ(4,"div",3),o.TgZ(5,"select",4),o.YNc(6,T,2,2,"option",5),o.qZA(),o.TgZ(7,"select",4),o.YNc(8,I,2,2,"option",5),o.qZA(),o.TgZ(9,"select",4),o.YNc(10,U,2,2,"option",5),o.qZA(),o.TgZ(11,"div",6),o._UZ(12,"input",7),o.TgZ(13,"label",8),o._uU(14," Show Crop Borders "),o.qZA(),o.qZA(),o.TgZ(15,"div",9),o._UZ(16,"input",10),o.TgZ(17,"label",11),o._uU(18," Show Crop Cross "),o.qZA(),o.qZA(),o.TgZ(19,"button",12),o.NdJ("click",function(){return t.print()}),o._UZ(20,"i",13),o._uU(21," Print "),o.qZA(),o.qZA(),o.qZA(),o.TgZ(22,"iframe",14,15),o.NdJ("load",function(){return t.setIframeLoaded()}),o.qZA(),o.qZA()),2&e&&(o.xp6(3),o.hij("Preview ",null==t.resourceInfo?null:t.resourceInfo.label,""),o.xp6(2),o.Q6J("formControl",t.form.get("locale")),o.xp6(1),o.Q6J("ngForOf",t.locales),o.xp6(1),o.Q6J("formControl",t.form.get("pageSize")),o.xp6(1),o.Q6J("ngForOf",t.pageSizes),o.xp6(1),o.Q6J("formControl",t.form.get("pageOrientation")),o.xp6(1),o.Q6J("ngForOf",t.pageOrientations),o.xp6(2),o.Q6J("formControl",t.form.get("showCropBorders")),o.xp6(4),o.Q6J("formControl",t.form.get("showCross")),o.xp6(6),o.Q6J("src",t.getPreviewURL(),o.uOi))},directives:[d.EJ,d.JJ,d.oH,r.sg,d.Wl,d.YN,d.Kr],styles:["[_nghost-%COMP%]{width:100%;height:100%}"],changeDetection:0}),e})()}];let J=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({imports:[[r.ez,d.u5,b.xD,a.Bz.forChild(S),d.UX,Z.z$,v.X0.forChild({extras:{lazyRender:!0},wrappers:[{name:"panel",component:w.Z}],types:[{name:"images",component:L.Pw,wrappers:["form-field"]},{name:"repeat",component:A.$},{name:"hasMany",component:q.a}]})]]}),e})()}}]);