(self.webpackChunknguide_pricelist_ui=self.webpackChunknguide_pricelist_ui||[]).push([[608],{5608:(e,t,i)=>{"use strict";i.r(t),i.d(t,{PricesModule:()=>y});var r=i(8583),o=i(7029),s=i(7716),c=i(9486),n=i(264),l=i(2340),a=i(1841);let p=(()=>{class e{constructor(e){this.http=e}getPriceListProductModelsAndOptions(e){return this.http.get(l.N.apiBaseURL+"prices/"+e)}savePrices(e,t){return this.http.put(l.N.apiBaseURL+"prices/"+e,{prices:t})}}return e.\u0275fac=function(t){return new(t||e)(s.LFG(a.eN))},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var d=i(1873),u=i(3679);function h(e,t){if(1&e){const e=s.EpF();s.ynx(0),s.TgZ(1,"td"),s.TgZ(2,"label"),s._uU(3,"Delivery price"),s.qZA(),s.TgZ(4,"input",10),s.NdJ("ngModelChange",function(t){s.CHM(e);const i=s.oxw().$implicit;return s.oxw(2).pricesModel[i.id].delivery_price=t}),s.qZA(),s.TgZ(5,"label"),s._uU(6,"Installation price"),s.qZA(),s.TgZ(7,"input",10),s.NdJ("ngModelChange",function(t){s.CHM(e);const i=s.oxw().$implicit;return s.oxw(2).pricesModel[i.id].installation_price=t}),s.qZA(),s.qZA(),s._UZ(8,"td"),s.BQk()}if(2&e){const e=s.oxw().$implicit,t=s.oxw(2);s.xp6(4),s.Q6J("ngModel",t.pricesModel[e.id].delivery_price),s.xp6(3),s.Q6J("ngModel",t.pricesModel[e.id].installation_price)}}function m(e,t){if(1&e){const e=s.EpF();s.ynx(0),s.TgZ(1,"td"),s.TgZ(2,"input",10),s.NdJ("ngModelChange",function(t){s.CHM(e);const i=s.oxw().$implicit;return s.oxw(2).pricesModel[i.id].value=t}),s.qZA(),s.qZA(),s.TgZ(3,"td"),s.TgZ(4,"input",11),s.NdJ("ngModelChange",function(t){s.CHM(e);const i=s.oxw().$implicit;return s.oxw(2).pricesModel[i.id].onDemand=t}),s.qZA(),s.qZA(),s.BQk()}if(2&e){const e=s.oxw().$implicit,t=s.oxw(2);s.xp6(2),s.Q6J("ngModel",t.pricesModel[e.id].value),s.xp6(2),s.Q6J("ngModel",t.pricesModel[e.id].onDemand)}}function g(e,t){if(1&e&&(s.TgZ(0,"tr"),s.TgZ(1,"td"),s._uU(2),s.qZA(),s.TgZ(3,"td"),s._uU(4),s.qZA(),s.YNc(5,h,9,2,"ng-container",9),s.YNc(6,m,5,2,"ng-container",9),s.qZA()),2&e){const e=t.$implicit;s.xp6(2),s.Oqu(e.name||"-"),s.xp6(2),s.Oqu(e.sku),s.xp6(1),s.Q6J("ngIf","product_main"===e.type),s.xp6(1),s.Q6J("ngIf","product_main"!==e.type)}}function f(e,t){if(1&e&&(s.TgZ(0,"table",6),s.TgZ(1,"thead"),s.TgZ(2,"tr"),s.TgZ(3,"th"),s._uU(4,"Name"),s.qZA(),s.TgZ(5,"th"),s._uU(6,"Sku"),s.qZA(),s.TgZ(7,"th",7),s._uU(8,"Price"),s.qZA(),s.TgZ(9,"th"),s._uU(10,"On Demand"),s.qZA(),s.qZA(),s.qZA(),s.TgZ(11,"tbody"),s.YNc(12,g,7,4,"tr",8),s.qZA(),s.qZA()),2&e){const e=s.oxw();s.xp6(12),s.Q6J("ngForOf",e.priceLists)}}let b=(()=>{class e{constructor(e,t,i,r,o){this.resourcesService=e,this.activatedRoute=t,this.pricesService=i,this.breadcrumbService=r,this.alertsService=o,this.priceLists=[],this.pricesModel={},this.priceListId=null,this.defaultLocale="nl"}ngOnInit(){this.activatedRoute.paramMap.subscribe(e=>{this.priceListId=e.get("id"),this.priceListId&&(this.initBreadcrumb(),this.loadData(this.priceListId))})}loadData(e){this.pricesService.getPriceListProductModelsAndOptions(e).subscribe(e=>{var t,i,r,o;this.priceLists=e.data,this.defaultLocale=e.defaultLocale;for(let s of this.priceLists)if("product_main"===s.type){const e={delivery_price:(null===(t=s.price)||void 0===t?void 0:t.delivery_price)||0,installation_price:(null===(i=s.price)||void 0===i?void 0:i.installation_price)||0};this.pricesModel[s.id]=e}else{const e={value:(null===(r=s.price)||void 0===r?void 0:r.value)||0,onDemand:(null===(o=s.price)||void 0===o?void 0:o.onDemand)||!1};this.pricesModel[s.id]=e}})}submit(){this.priceListId&&this.pricesService.savePrices(this.priceListId,this.pricesModel).subscribe(e=>{this.alertsService.show(o.NK.success,"Prices updated!")})}initBreadcrumb(){this.breadcrumbService.setBreadcrumb([{label:"Home",path:["/dashboard"]},{label:"Price lists",path:["/resources/priceList"]},{label:"Edit Price list",path:[`/resources/priceList/${this.priceListId}/edit`]},{label:"Assign Prices",path:[`/price-assign/${this.priceListId}`]}]),this.breadcrumbService.update()}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(c.z6),s.Y36(n.gz),s.Y36(p),s.Y36(d.p),s.Y36(o.ml))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-price-assign"]],decls:8,vars:2,consts:[[1,"pt-4","row","sticky-top","bg-white","overflow-hidden","pb-2","border-bottom"],[1,"col-9"],[1,"col-3","text-end"],["type","button",1,"btn","btn-primary","submit-button",3,"disabled","click"],[1,"bi","bi-save"],["class","table mt-2",4,"ngIf"],[1,"table","mt-2"],[2,"width","200px"],[4,"ngFor","ngForOf"],[4,"ngIf"],["type","number",1,"form-control","form-control-sm",3,"ngModel","ngModelChange"],["type","checkbox",1,"form-check-input",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(s.TgZ(0,"div",0),s.TgZ(1,"h2",1),s._uU(2,"Assign Prices"),s.qZA(),s.TgZ(3,"div",2),s.TgZ(4,"button",3),s.NdJ("click",function(){return t.submit()}),s._UZ(5,"i",4),s._uU(6," Save "),s.qZA(),s.qZA(),s.qZA(),s.YNc(7,f,13,1,"table",5)),2&e&&(s.xp6(4),s.Q6J("disabled",!t.priceListId),s.xp6(3),s.Q6J("ngIf",t.priceLists.length>0))},directives:[r.O5,r.sg,u.wV,u.Fj,u.JJ,u.On,u.Wl],styles:[""]}),e})();var v=i(8550),Z=i(6715),w=i(3500),A=i(2114),x=i(6661),L=i(4463),q=i(5790),T=i(9075);const C=["iframe"];function U(e,t){if(1&e&&(s.TgZ(0,"option",16),s._uU(1),s.qZA()),2&e){const e=t.$implicit;s.Q6J("value",e.key),s.xp6(1),s.Oqu(e.value)}}function _(e,t){if(1&e&&(s.TgZ(0,"option",16),s._uU(1),s.qZA()),2&e){const e=t.$implicit;s.Q6J("value",e),s.xp6(1),s.Oqu(e)}}function I(e,t){if(1&e&&(s.TgZ(0,"option",16),s._uU(1),s.qZA()),2&e){const e=t.$implicit;s.Q6J("value",e),s.xp6(1),s.Oqu(e)}}const M=[{path:":id",component:b},{path:"preview/:id",component:(()=>{class e{constructor(e,t,i,r,o){this.ref=e,this.activatedRoute=t,this.sanitizer=i,this.breadcrumbService=r,this.resourcesService=o,this.priceListId=null,this.resourceName="priceList",this.templateUrl="",this.iframeLoaded=!1,this.locales=[],this.defaultLocale="nl",this.resourceInfo=null,this.pageSizes=["A0","A1","A2","A3","A4","A5","A6","A7","A10","B4","B5","letter","legal","ledger"],this.pageOrientations=["portrait","landscape"],this.model={},this.mainUrl="",this.form=new u.cw({locale:new u.NI(""),pageSize:new u.NI("A4"),showCropBorders:new u.NI(!1),showCross:new u.NI(!1),pageOrientation:new u.NI("portrait")})}ngOnInit(){this.activatedRoute.paramMap.subscribe(e=>{this.priceListId=e.get("id"),this.resourceName&&this.resourcesService.getResourceInfo(this.resourceName).subscribe(e=>{this.resourceInfo=e,this.initBreadcrumb(),this.priceListId&&this.resourcesService.getEditResourceSchema(this.resourceName,this.priceListId).subscribe(e=>{var t,i;this.defaultLocale=e.defaultLocale,null===(t=this.form.get("locale"))||void 0===t||t.setValue(this.defaultLocale),this.model=null==e?void 0:e.data,this.locales=this.mapLocales(e.locales,(null===(i=this.model)||void 0===i?void 0:i.language)||[]),this.mainUrl=l.N.apiBaseURL+"resources/"+this.resourceName+"/"+this.priceListId+"/html?path=&template=pricelist",this.updateTemplateUrl(this.form.value)})})}),this.form.valueChanges.subscribe(e=>{e&&this.updateTemplateUrl(e)})}updateTemplateUrl(e){const t={locale:(null==e?void 0:e.locale)||"nl",pageSize:(null==e?void 0:e.pageSize)||"A4",showCropBorders:(null==e?void 0:e.showCropBorders)||!1,showCross:(null==e?void 0:e.showCross)||!1,pageOrientation:(null==e?void 0:e.pageOrientation)||"portrait"},i=[];this.iframeLoaded=!1;for(const r in t)i.push(r+"="+t[r]);this.ref.reattach(),this.templateUrl=this.mainUrl+"&"+i.join("&")}getPreviewURL(){const e=this.sanitizer.bypassSecurityTrustResourceUrl(this.templateUrl);return this.templateUrl&&this.ref.detach(),e}mapLocales(e,t){const i=[];for(const r in e)t.includes(r)&&i.push({key:r,value:e[r]});return i}initBreadcrumb(){this.breadcrumbService.setBreadcrumb([{label:"Home",path:["/dashboard"]},{label:"Price lists",path:["/resources/priceList"]},{label:"Edit Price list",path:[`/resources/priceList/${this.priceListId}/edit`]},{label:"Preview Price List",path:[`/price-assign/preview/${this.priceListId}`]}]),this.breadcrumbService.update()}print(){window.open(this.templateUrl,"_blank")}setIframeLoaded(){}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(s.sBO),s.Y36(n.gz),s.Y36(T.H7),s.Y36(d.p),s.Y36(c.z6))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-preview"]],viewQuery:function(e,t){if(1&e&&s.Gf(C,5),2&e){let e;s.iGM(e=s.CRH())&&(t.iframe=e.first)}},decls:24,vars:10,consts:[[1,"d-flex","flex-column","h-100"],[1,"pt-4","row","sticky-top","bg-white","overflow-hidden","border-bottom","pb-2"],[1,"col-3","mb-0"],[1,"col-9","text-end","row","g-3","m-0"],[1,"form-select","col","me-2","mt-0",3,"formControl"],[3,"value",4,"ngFor","ngForOf"],["title","Show Crop Borders",1,"form-check","col","me-2","mt-2"],["type","checkbox","id","showCropBorders",1,"form-check-input",3,"formControl"],["for","showCropBorders",1,"form-check-label","text-truncate"],["title","Show Crop Cross",1,"form-check","col","me-2","mt-2"],["type","checkbox","id","showCross",1,"form-check-input",3,"formControl"],["for","showCross",1,"form-check-label","text-truncate"],["type","button",1,"btn","btn-primary","col","me-2","mt-0",3,"click"],[1,"bi","bi-printer"],[1,"mt-3","flex-grow-1",3,"src","load"],["iframe",""],[3,"value"]],template:function(e,t){1&e&&(s.TgZ(0,"div",0),s.TgZ(1,"div",1),s.TgZ(2,"h2",2),s._uU(3),s.qZA(),s.TgZ(4,"div",3),s.TgZ(5,"select",4),s.YNc(6,U,2,2,"option",5),s.qZA(),s.TgZ(7,"select",4),s.YNc(8,_,2,2,"option",5),s.qZA(),s.TgZ(9,"select",4),s.YNc(10,I,2,2,"option",5),s.qZA(),s.TgZ(11,"div",6),s._UZ(12,"input",7),s.TgZ(13,"label",8),s._uU(14," Show Crop Borders "),s.qZA(),s.qZA(),s.TgZ(15,"div",9),s._UZ(16,"input",10),s.TgZ(17,"label",11),s._uU(18," Show Crop Cross "),s.qZA(),s.qZA(),s.TgZ(19,"button",12),s.NdJ("click",function(){return t.print()}),s._UZ(20,"i",13),s._uU(21," Print "),s.qZA(),s.qZA(),s.qZA(),s.TgZ(22,"iframe",14,15),s.NdJ("load",function(){return t.setIframeLoaded()}),s.qZA(),s.qZA()),2&e&&(s.xp6(3),s.hij("Preview ",null==t.resourceInfo?null:t.resourceInfo.label,""),s.xp6(2),s.Q6J("formControl",t.form.get("locale")),s.xp6(1),s.Q6J("ngForOf",t.locales),s.xp6(1),s.Q6J("formControl",t.form.get("pageSize")),s.xp6(1),s.Q6J("ngForOf",t.pageSizes),s.xp6(1),s.Q6J("formControl",t.form.get("pageOrientation")),s.xp6(1),s.Q6J("ngForOf",t.pageOrientations),s.xp6(2),s.Q6J("formControl",t.form.get("showCropBorders")),s.xp6(4),s.Q6J("formControl",t.form.get("showCross")),s.xp6(6),s.Q6J("src",t.getPreviewURL(),s.uOi))},directives:[u.EJ,u.JJ,u.oH,r.sg,u.Wl,u.YN,u.Kr],styles:["[_nghost-%COMP%]{width:100%;height:100%}"],changeDetection:0}),e})()}];let y=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({imports:[[r.ez,u.u5,v.xD,n.Bz.forChild(M),u.UX,Z.z$,w.X0.forChild({extras:{lazyRender:!0},wrappers:[{name:"panel",component:A.Z}],types:[{name:"images",component:x.Pw,wrappers:["form-field"]},{name:"repeat",component:L.$},{name:"hasMany",component:q.a}]})]]}),e})()}}]);